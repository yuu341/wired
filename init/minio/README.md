# MinIOåˆæœŸè¨­å®šã«ã¤ã„ã¦

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
init_minio/
â”œâ”€â”€ README.md              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ init.sh               # åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ users.txt             # ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
â”œâ”€â”€ buckets.txt           # ãƒã‚±ãƒƒãƒˆè¨­å®š
â””â”€â”€ policies/             # ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼
    â”œâ”€â”€ app-user-policy.json
    â””â”€â”€ readonly-policy.json
```

## ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š (`users.txt`)

å½¢å¼: `ãƒ¦ãƒ¼ã‚¶ãƒ¼å:ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:ãƒãƒªã‚·ãƒ¼`

### å®šç¾©æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼

| ãƒ¦ãƒ¼ã‚¶ãƒ¼å | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | ãƒãƒªã‚·ãƒ¼ | èª¬æ˜ |
|-----------|-----------|----------|------|
| admin | admin123 | consoleAdmin | ç®¡ç†è€… |
| app-user | app-secret-key | readwrite | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ |
| readonly-user | readonly-pass | readonly | èª­ã¿å–ã‚Šå°‚ç”¨ |
| dev-user | dev-password | readwrite | é–‹ç™ºè€…ç”¨ |

### åˆ©ç”¨å¯èƒ½ãªãƒãƒªã‚·ãƒ¼

- `consoleAdmin`: å…¨æ¨©é™
- `readwrite`: èª­ã¿æ›¸ãæ¨©é™
- `readonly`: èª­ã¿å–ã‚Šå°‚ç”¨

## ğŸª£ ãƒã‚±ãƒƒãƒˆè¨­å®š (`buckets.txt`)

å½¢å¼: `ãƒã‚±ãƒƒãƒˆå:ãƒãƒªã‚·ãƒ¼:ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°:æš—å·åŒ–`

### å®šç¾©æ¸ˆã¿ãƒã‚±ãƒƒãƒˆ

| ãƒã‚±ãƒƒãƒˆå | ãƒãƒªã‚·ãƒ¼ | ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° | æš—å·åŒ– | ç”¨é€” |
|-----------|----------|---------------|--------|------|
| dev-bucket | public | enabled | disabled | é–‹ç™ºç”¨ |
| prod-bucket | private | enabled | enabled | æœ¬ç•ªç”¨ |
| user-uploads | download | enabled | disabled | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| static-assets | public | disabled | disabled | é™çš„ãƒ•ã‚¡ã‚¤ãƒ« |
| app-logs | private | enabled | disabled | ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« |
| backups | private | enabled | enabled | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— |

### ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼

- `public`: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- `download`: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ã¿å¯èƒ½
- `private`: èªè¨¼ãŒå¿…è¦

## ğŸ” ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ (`policies/`)

### app-user-policy.json
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©³ç´°æ¨©é™è¨­å®š
- `dev-bucket`, `user-uploads` ã¸ã®èª­ã¿æ›¸ãæ¨©é™

### readonly-policy.json
èª­ã¿å–ã‚Šå°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è©³ç´°æ¨©é™è¨­å®š
- `dev-bucket`, `static-assets` ã¸ã®èª­ã¿å–ã‚Šæ¨©é™

## ğŸ› ï¸ è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ 

`users.txt` ã«ä»¥ä¸‹ã®å½¢å¼ã§è¿½åŠ :
```
new-user:new-password:readwrite
```

### æ–°ã—ã„ãƒã‚±ãƒƒãƒˆã‚’è¿½åŠ 

`buckets.txt` ã«ä»¥ä¸‹ã®å½¢å¼ã§è¿½åŠ :
```
new-bucket:public:enabled:disabled
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ 

`policies/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.json` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®

## ğŸš€ ä½¿ç”¨æ–¹æ³•

Docker Composeã§è‡ªå‹•çš„ã«åˆæœŸåŒ–ã•ã‚Œã¾ã™:

```bash
docker compose up -d
```

æ‰‹å‹•ã§åˆæœŸåŒ–ã™ã‚‹å ´åˆ:

```bash
docker compose run --rm minio-setup
```

## âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ³¨æ„äº‹é …

### æœ¬ç•ªç’°å¢ƒã§ã®æ³¨æ„ç‚¹

1. **å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨**
   ```
   admin:$(openssl rand -base64 32):consoleAdmin
   ```

2. **ä¸è¦ãªãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒã‚±ãƒƒãƒˆã‚’å‰Šé™¤**

3. **æœ€å°æ¨©é™ã®åŸå‰‡ã‚’é©ç”¨**

4. **å®šæœŸçš„ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´**

## ğŸ”„ è¨­å®šã®æ›´æ–°

è¨­å®šã‚’å¤‰æ›´ã—ãŸå ´åˆ:

1. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
2. ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•
   ```bash
   docker compose restart minio-setup
   ```

## ğŸ“‹ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] `users.txt` ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç¢ºèª
- [ ] `buckets.txt` ã§ãƒã‚±ãƒƒãƒˆè¨­å®šç¢ºèª
- [ ] `policies/` ã§ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ç¢ºèª
- [ ] æœ¬ç•ªç’°å¢ƒç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- [ ] ä¸è¦ãªãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹å‰Šé™¤
- [ ] åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œç¢ºèª